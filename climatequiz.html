<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Climate Crisis Quiz</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0f172a;
  --accent: #7dd3fc;
  --muted: rgba(255,255,255,0.75);
  --correct: #4caf50;
  --incorrect: #ff704d;
  --card-bg: rgba(255,255,255,0.05);
  --shadow: rgba(0,0,0,0.5);
}

body {
  margin:0;
  font-family: Inter, sans-serif;
  background: linear-gradient(180deg,var(--bg),#04263b);
  color: var(--muted);
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:30px 20px;
  min-height: 100vh;
}

h1 {
  font-size: clamp(26px,4vw,36px);
  color:#fff;
  margin-bottom:20px;
  text-align:center;
}

.quiz-container {
  width: 100%;
  max-width: 750px;
  background: var(--card-bg);
  border-radius:16px;
  padding:30px;
  display:flex;
  flex-direction:column;
  align-items:center;
  box-shadow: 0 10px 25px var(--shadow);
  transition: transform 0.3s ease;
  position: relative;
}

.progress-container {
  width: 100%;
  height: 14px;
  background: rgba(255,255,255,0.1);
  border-radius: 7px;
  margin-bottom: 20px;
}

.progress-bar {
  height: 100%;
  width: 0%;
  background: var(--accent);
  border-radius: 7px;
  transition: width 0.4s;
}

h2 {
  color:#fff;
  font-size:22px;
  margin-bottom:20px;
  text-align:center;
}

.options-container {
  display:flex;
  flex-direction:column;
  width:100%;
  gap:12px;
}

.option-btn {
  padding:12px 20px;
  border-radius:12px;
  background: rgba(125,211,252,0.1);
  border:2px solid rgba(125,211,252,0.3);
  color:#fff;
  font-weight:600;
  cursor:pointer;
  transition: all 0.2s ease;
  text-align:left;
  display:flex;
  align-items:center;
  gap:10px;
}

.option-btn.selected {
  border:2px solid var(--accent);
  background: rgba(125,211,252,0.2);
}

.option-btn.correct { background: var(--correct); border-color: var(--correct); color:#fff;}
.option-btn.incorrect { background: var(--incorrect); border-color: var(--incorrect); color:#fff;}

#feedback {
  position:absolute;
  top:-50px;
  left:50%;
  transform: translateX(-50%);
  padding:12px 25px;
  border-radius:12px;
  font-weight:700;
  display:none;
  color:#fff;
  font-size:18px;
  z-index:100;
}

.drag-container {
  display:flex;
  justify-content:space-between;
  flex-wrap:wrap;
  gap:20px;
  margin-top:20px;
}

.draggables, .droppables {
  display:flex;
  flex-direction:column;
  gap:10px;
}

.draggable {
  background: rgba(125,211,252,0.2);
  padding:10px 15px;
  border-radius:10px;
  cursor: grab;
  color:#fff;
  user-select:none;
  text-align:center;
}

.droppable {
  background: rgba(255,255,255,0.05);
  border:2px dashed rgba(255,255,255,0.2);
  border-radius:10px;
  padding:15px;
  min-width:140px;
  text-align:center;
  color:#fff;
}

#completionScreen {
  display:none;
  flex-direction:column;
  align-items:center;
  text-align:center;
  margin-top:50px;
}

#completionScreen button {
  margin-top:15px;
  background: var(--accent);
  color:#08121b;
  border:none;
  padding:12px 20px;
  border-radius:12px;
  font-weight:700;
  cursor:pointer;
  margin-right:10px;
}

#completionScreen button:hover {
  transform: translateY(-2px);
}

canvas.confettiCanvas {
  position: fixed;
  top:0;
  left:0;
  pointer-events:none;
  width:100%;
  height:100%;
  z-index:9999;
}
</style>
</head>
<body>

<h1>Climate Crisis Challenge</h1>
<div class="progress-container">
  <div class="progress-bar" id="progressBar"></div>
</div>

<div class="quiz-container" id="quizContainer"></div>

<div id="completionScreen">
  <h2 id="completionText"></h2>
  <div>
    <button id="retryBtn">Retry Quiz</button>
    <button id="returnBtn">Return to Topics</button>
  </div>
</div>

<div id="feedback"></div>

<canvas class="confettiCanvas" id="confettiCanvas"></canvas>

<script>
// Quiz Data
const quizData = [
  {question:"Why are Native American reservations more vulnerable to climate change impacts?",
   options:["They have weaker infrastructure and resources","They are immune to temperature changes","They are wealthy urban areas","They receive abundant rainfall"], correct:["They have weaker infrastructure and resources"]},

  {question:"Which of the following contribute to the climate crisis affecting Native Americans? Select ALL that apply.",
   options:["Carbon emissions","Fossil fuel use","Deforestation","Respect for Native land"], correct:["Carbon emissions","Fossil fuel use","Deforestation"]},

  {question:"How did Columbusâ€™s invasion make Native Americans more at risk from climate change?",
   options:["He displaced them to fragile land","He taught them environmental protection","He built green infrastructure","He improved their access to water"], correct:["He displaced them to fragile land"]},

  {question:"What are key effects of the climate crisis on Native communities? Select ALL that apply.",
   options:["Loss of land","Water shortages","Improved resources","Forced migration"], correct:["Loss of land","Water shortages","Forced migration"]},

  {question:"Which actions can help combat the climate crisis for Native Americans? Select ALL that apply.",
   options:["Adopting traditional sustainable practices","Government collaboration with tribes","Respecting Native boundaries","Ignoring the issue"], correct:["Adopting traditional sustainable practices","Government collaboration with tribes","Respecting Native boundaries"]},

  {question:"Match the issue to its correct cause:",
   type:"dragdrop",
   pairs:{
     "Land damage":"Fossil fuel pollution",
     "Water scarcity":"Climate change and drought",
     "Community displacement":"Environmental injustice"
   }}
];

let currentQuestion=0;
const questionScores=Array(quizData.length).fill(false);
const quizContainer=document.getElementById("quizContainer");
const progressBar=document.getElementById("progressBar");
const feedback=document.getElementById("feedback");
const completionScreen=document.getElementById("completionScreen");

// Show Question
function showQuestion(){
  quizContainer.innerHTML="";
  const q = quizData[currentQuestion];

  const questionEl = document.createElement("h2");
  questionEl.textContent = q.question;
  quizContainer.appendChild(questionEl);

  if(q.type==="dragdrop"){
    const dragContainer=document.createElement("div");
    dragContainer.className="drag-container";
    const draggablesDiv=document.createElement("div");
    draggablesDiv.className="draggables";
    for(const key in q.pairs){
      const dragItem=document.createElement("div");
      dragItem.className="draggable";
      dragItem.draggable=true;
      dragItem.textContent=key;
      dragItem.dataset.correct=q.pairs[key];
      dragItem.addEventListener("dragstart", dragStart);
      draggablesDiv.appendChild(dragItem);
    }
    const droppablesDiv=document.createElement("div");
    droppablesDiv.className="droppables";
    for(const val of Object.values(q.pairs)){
      const dropItem=document.createElement("div");
      dropItem.className="droppable";
      dropItem.textContent=val;
      dropItem.addEventListener("dragover", dragOver);
      dropItem.addEventListener("drop", dropItemHandler);
      droppablesDiv.appendChild(dropItem);
    }
    dragContainer.appendChild(draggablesDiv);
    dragContainer.appendChild(droppablesDiv);
    quizContainer.appendChild(dragContainer);
  } else {
    const optionsDiv=document.createElement("div");
    optionsDiv.className="options-container";

    q.options.forEach(opt=>{
      const btn=document.createElement("button");
      btn.className="option-btn";
      btn.textContent=opt;
      btn.addEventListener("click",()=>btn.classList.toggle("selected"));
      optionsDiv.appendChild(btn);
    });

    const submitBtn=document.createElement("button");
    submitBtn.textContent="Submit Answer";
    submitBtn.style.marginTop="15px";
    submitBtn.style.backgroundColor="var(--accent)";
    submitBtn.style.color="#08121b";
    submitBtn.style.borderRadius="12px";
    submitBtn.style.fontWeight="700";
    submitBtn.style.padding="10px 20px";
    submitBtn.addEventListener("click",()=>checkMultiAnswer(q));
    optionsDiv.appendChild(submitBtn);

    quizContainer.appendChild(optionsDiv);
  }

  updateProgress();
}

// Multi-choice check
function checkMultiAnswer(q){
  const selectedBtns=Array.from(document.querySelectorAll(".option-btn.selected"));
  const selected=selectedBtns.map(b=>b.textContent);
  const correctAnswers=q.correct.sort();
  const selectedSorted=selected.sort();

  const isCorrect=JSON.stringify(correctAnswers)===JSON.stringify(selectedSorted);
  questionScores[currentQuestion]=isCorrect;

  selectedBtns.forEach(b=>{
    if(q.correct.includes(b.textContent)) b.classList.add("correct");
    else b.classList.add("incorrect");
  });

  q.correct.forEach(c=>{
    if(!selected.includes(c)){
      const missedBtn=Array.from(document.querySelectorAll(".option-btn")).find(b=>b.textContent===c);
      if(missedBtn) missedBtn.classList.add("incorrect");
    }
  });

  showFeedback(isCorrect);
  currentQuestion++;
  setTimeout(()=>currentQuestion<quizData.length?showQuestion():showCompletion(),1200);
}

// Feedback animation
function showFeedback(isCorrect){
  feedback.textContent=isCorrect ? "Correct!" : "Incorrect!";
  feedback.style.backgroundColor=isCorrect ? "#4caf50" : "#ff704d";
  feedback.style.display="block";

  if(!isCorrect){
    const c=quizContainer;
    c.style.transition="transform 0.1s";
    c.style.transform="translateX(-30px)";
    setTimeout(()=>c.style.transform="translateX(30px)",100);
    setTimeout(()=>c.style.transform="translateX(-25px)",200);
    setTimeout(()=>c.style.transform="translateX(25px)",300);
    setTimeout(()=>c.style.transform="translateX(-15px)",400);
    setTimeout(()=>c.style.transform="",500);
  }
  setTimeout(()=>feedback.style.display="none",3000);
}

// Progress bar
function updateProgress(){
  const percent=((currentQuestion)/quizData.length)*100;
  progressBar.style.width=percent+"%";
}

// Drag-drop
let dragged;
function dragStart(e){ dragged=e.target; }
function dragOver(e){ e.preventDefault(); }
function dropItemHandler(e){
  e.preventDefault();
  const dropTarget=e.target;
  if(dragged.dataset.correct===dropTarget.textContent){
    dropTarget.style.backgroundColor="#4caf50";
    dragged.style.display="none";
  } else {
    dropTarget.style.backgroundColor="#ff704d";
    showFeedback(false);
  }

  if(document.querySelectorAll(".draggable:not([style*='display: none'])").length===0){
    const q = quizData[currentQuestion];
    const allCorrect = Array.from(document.querySelectorAll(".droppable")).every(d=>{
      const key = Object.keys(q.pairs).find(k=>q.pairs[k]===d.textContent);
      return d.textContent===q.pairs[key];
    });
    questionScores[currentQuestion]=allCorrect;
    currentQuestion++;
    setTimeout(()=>currentQuestion<quizData.length?showQuestion():showCompletion(),700);
  }
}

// Completion
function showCompletion(){
  quizContainer.style.display="none";
  completionScreen.style.display="flex";
  const scoreTotal = questionScores.filter(v=>v).length;
  document.getElementById("completionText").textContent=`Quiz Completed! You scored ${scoreTotal} out of ${quizData.length}`;
  if(scoreTotal===quizData.length) launchConfetti();
}

// Buttons
document.getElementById("retryBtn").addEventListener("click",()=>{
  currentQuestion=0;
  questionScores.fill(false);
  completionScreen.style.display="none";
  quizContainer.style.display="flex";
  showQuestion();
});
document.getElementById("returnBtn").addEventListener("click",()=>window.location.href="topics.html");

// Confetti
function launchConfetti(){
  const canvas = document.getElementById("confettiCanvas");
  const ctx = canvas.getContext("2d");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  const confettis = [];
  for(let i = 0; i < 150; i++){
    confettis.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      r: Math.random() * 6 + 4,
      dx: (Math.random() * 2 - 1),
      dy: (Math.random() * 2 + 2),
      color: `hsl(${Math.random()*360},100%,50%)`
    });
  }

  let animationId;
  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    confettis.forEach(c=>{
      ctx.fillStyle = c.color;
      ctx.beginPath();
      ctx.arc(c.x,c.y,c.r,0,Math.PI*2);
      ctx.fill();
      c.x += c.dx; c.y += c.dy;
      if(c.y > canvas.height){ c.y = 0; c.x = Math.random()*canvas.width; }
    });
    animationId = requestAnimationFrame(draw);
  }
  draw();
  setTimeout(() => {
    cancelAnimationFrame(animationId);
    ctx.clearRect(0,0,canvas.width,canvas.height);
  }, 4500);
}

showQuestion();
</script>
</body>
</html>
